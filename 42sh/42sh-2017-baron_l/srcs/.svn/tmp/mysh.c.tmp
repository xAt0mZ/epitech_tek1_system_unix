/*
** mysh.c for minishell1 in /home/baron_l//local/rendu/projets/system_unix/minishell1/rendu
** 
** Made by louis-philippe baron
** Login   <baron_l@epitech.net>
** 
** Started on  Mon Dec 17 15:45:17 2012 louis-philippe baron
<<<<<<< .mine
** Last update Sat May 25 15:14:56 2013 louis-philippe baron
=======
** Last update Sat May 25 15:15:40 2013 marie lefebvre
>>>>>>> .r41
*/

#include	"h42.h"

int	free_wordtab(char **res)
{
  int		i;

  i = 0;
  while (res[i])
    {
      free(res[i]);
      i++;
    }
  free(res);
  return (0);
}

int	show_wdtb(char **tab)
{
  int		j;

  j = 0;
  while (tab[j])
    {
      my_putchar('{');
      my_putstr(tab[j]);
      my_putchar('}');
      my_putchar('\n');
      j++;
    }
  return (0);
}

static int	in_command(char *command, t_glob *glob)
{
  char		**tmp;

  if (check_quotes(command) == ERROR)
    {
      my_putstr("---------------\n");
      return (0);
    }
  if ((tmp = my_command_to_wordtab(command, "|&")) == NULL)
    return (error_int("Problem in memory allocation during command parsing\n"));
  if (!(tmp = cut_redir_tab(tmp, glob)))
    {
      if (glob->retval == ERROR)
	return (ERROR);
      return (SUCCESS);
    }
  show_wdtb(tmp);
  if (tree_call(tmp, glob) == ERROR)
    return (ERROR);
  free_wordtab(tmp);
  return (0);
}

static int	exec_separated_command(char **command, t_glob *glob)
{
  int		k;

  k = 0;
  while (command[k])
    {
      if (in_command(command[k], glob) == ERROR)
	return (ERROR);
      k++;
    }
  return (0);
}

int		mysh(t_glob *glob)
{
  char		**command;

  if ((glob->input = epur_str(glob->input, "><|;&", 0)) == NULL)
    return (ERROR);
  if (glob->input[0] == 0)
    {
<<<<<<< .mine
      free(glob->input[0]);
=======
      free(glob->input);
>>>>>>> .r41
      return (0);
    }
<<<<<<< .mine
  /* if (glob_it(&(glob->input), "*?[]{}") == ERROR) */
  /*   return (ERROR); */
=======
  /*if (glob_it(&(glob->input), "*?[]{}") == ERROR)
    return (ERROR);*/
>>>>>>> .r41
  if ((command = my_str_to_wordtab(glob->input, ";")) == NULL)
    return (error_int("Problem in memory allocation during command parsing\n"));
  free(glob->input);
  if (exec_separated_command(command, glob) == ERROR)
    return (ERROR);
  free_wordtab(command);
  return (0);
}
